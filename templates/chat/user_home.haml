- extends "smartmin/base.html"

- load smartmin i18n

- block content

  .{role:"tabpanel"}
    %ul#room-tabs.nav.nav-tabs{role:"tablist"}
      - for room in rooms
        %li{role:"presentation"}
          %a{role:"tab", href:"#room_{{ room.id }}", aria-controls:"room_{{ room.id }}", data-toggle:"tab"}
            {{ room.name }}

    .tab-content
      - for room in rooms
        .tab-pane{role:"tabpanel", id:"room_{{ room.id }}", data-room-id:"{{ room.id }}"}
          .{style:"text-align: center; padding: 1em"}
            %form.room-sendform
              %input{type:"hidden", name:"room", value:"{{ room.id }}"}
              .input-group
                %input.form-control{type:"text", name:"text", autocomplete:"off"}
                %span.input-group-btn
                  %button.btn.btn-default{type:"button"}
                    -trans "Send"

          .room-messages


- block extra-script
  :javascript
    $(function () {
      $('#room-tabs a').click(function (e) {
        e.preventDefault();
        $(this).tab('show');
      });

      $('#room-tabs a:first').tab('show');

      $('.room-sendform').each(function() {
        $(this).submit(function(event) {
          send_url = "{% url 'chat.message_send' %}?" + $(this).serialize();
          console.log(send_url);
          $.post(send_url).done(function(data) {
            console.log(data);
          });
          event.preventDefault();
        });
      });

      $('.room-messages').each(function() {
        room_id = $(this).parent().data('room-id');
        fetch_messages(room_id);
      });
    });


    function fetch_messages(room_id) {
      messages_url = "{% url 'chat.message_list' %}?room=" + room_id;
      $.get(messages_url).done(function(data) {
        console.log(data);
      });
    }

